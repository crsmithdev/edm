<annotate-context>
  <cmd>/annotate &lt;subcommand&gt;</cmd>
  <script>.claude/scripts/annotate.sh</script>

  <subcommands>
    <generate args="[files]">Analyze audio → generated/ (no args: re-analyze from reference/)</generate>
    <merge>reference + generated → working/</merge>
    <save>working → reference/ (strips raw)</save>
  </subcommands>

  <directories>
    <dir path="data/annotations/reference/" tracked="git" role="source of truth"/>
    <dir path="data/annotations/generated/" tracked="no" role="machine output"/>
    <dir path="data/annotations/working/" tracked="no" role="editing workspace"/>
  </directories>

  <workflow>
    <step cmd="/annotate generate ~/music/*.flac">Analyze audio files</step>
    <step cmd="/annotate merge">Prepare for editing</step>
    <step>Edit YAML in working/</step>
    <step cmd="/annotate save">Preserve to reference/</step>
    <step cmd="/evaluate">Measure accuracy</step>
  </workflow>

  <format path="reference/*.yaml">
    <field name="file" type="path"/>
    <field name="duration" type="str" format="M:SS.ss"/>
    <field name="bpm" type="float"/>
    <field name="downbeat" type="float" unit="seconds"/>
    <field name="time_signature" type="str" default="4/4"/>
    <field name="annotations" type="list">
      <item format="[bar, label, timestamp]"/>
      <labels>intro|buildup|drop|breakdown|outro|other</labels>
    </field>
  </format>

  <format path="working/*.yaml" extends="reference">
    <raw-events>Appended as comments after --- separator</raw-events>
  </format>

  <safety>
    <rule>reference/ never contains raw events</rule>
    <rule>Regeneration cannot overwrite user data</rule>
    <rule>Only reference/ is git-tracked</rule>
  </safety>
</annotate-context>
