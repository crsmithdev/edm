<python-context>
  <purpose>Python code style, Typer CLI, testing for EDM project</purpose>

  <style>
    <format tool="ruff" line="100" quotes="double"/>
    <types required="all" syntax="3.12+" unions="str | None" lists="list[str]"/>
    <docstrings style="Google" example="src/edm/analysis/bpm.py:36"/>
  </style>

  <imports order="stdlib → third-party → local" separator="blank line">
    <prefer>from typing import Literal</prefer>
    <prefer>import structlog</prefer>
    <avoid>from foo import *</avoid>
  </imports>

  <exceptions base="EDMError" file="src/edm/exceptions.py">
    <rule>Preserve chains: raise NewError(...) from e</rule>
    <types>BPMDetectionError, StructureDetectionError, AudioLoadError</types>
  </exceptions>

  <pydantic version="v2">
    <models>Field(gt=0, le=1), model_validator for cross-field</models>
    <validate at="boundaries (CLI, file I/O)" trust="internal code"/>
  </pydantic>

  <logging lib="structlog">
    <init>get_logger(__name__)</init>
    <levels debug="internals" info="progress" warning="fallbacks" error="failures"/>
    <output console="colored" json="structured" flags="--log-level, --json-logs"/>
  </logging>

  <typer>
    <files main="src/cli/main.py" commands="src/cli/commands/*.py"/>
    <arg syntax="typer.Argument(..., help='...')"/>
    <opt syntax="typer.Option(default, '--flag', '-f', help='...')"/>
    <output table="Rich Console" machine="JSON/YAML" flag="--format"/>
  </typer>

  <testing framework="pytest" dir="src/tests/">
    <structure unit="tests/unit/" integration="tests/integration/" fixtures="conftest.py"/>
    <assert floats="pytest.approx(128.0, abs=0.5)" exceptions="pytest.raises()"/>
  </testing>

  <async lib="asyncio" http="httpx">
    <use>I/O-bound tasks</use>
    <avoid>CPU-bound (audio processing)</avoid>
  </async>

  <commands>
    <run>uv run edm analyze track.mp3</run>
    <test>uv run pytest -v</test>
    <lint>uv run ruff check --fix . && ruff format .</lint>
    <typecheck>uv run mypy src/</typecheck>
  </commands>
</python-context>
